<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>A Deterministic Algorithm for Resolving Shortlinks with Internal Redirects</title>
<meta content="Ethan Davidson" name="author">
<meta content="
       This document specifies a deterministic algorithm for resolving shortlinks
(compact string identifiers) into fully-qualified URLs. The algorithm supports
both absolute URL destinations and origin-relative internal redirects with loop
protection. It defines deterministic precedence rules for combining query
parameters and fragments from multiple sources during resolution, enabling
consistent behavior across clients, servers, and command-line tools. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="shortlinks" name="keyword">
<meta content="URL resolution" name="keyword">
<meta content="redirects" name="keyword">
<meta content="link shortening" name="keyword">
<meta content="draft-go-protocol-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.12.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.5.0
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.5
    wcwidth 0.2.14
-->
<link href="draft-go-protocol.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">A Deterministic Algorithm for Resolving </td>
<td class="right">November 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Davidson</td>
<td class="center">Expires 6 May 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">N/A</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-go-protocol-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-11-02" class="published">2 November 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-05-06">6 May 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Davidson</div>
<div class="org">FartLabs</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">A Deterministic Algorithm for Resolving Shortlinks with Internal Redirects</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a deterministic algorithm for resolving shortlinks
(compact string identifiers) into fully-qualified URLs. The algorithm supports
both absolute URL destinations and origin-relative internal redirects with loop
protection. It defines deterministic precedence rules for combining query
parameters and fragments from multiple sources during resolution, enabling
consistent behavior across clients, servers, and command-line tools.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 May 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-algorithm-specification" class="internal xref">Algorithm Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-initialization-phase" class="internal xref">Initialization Phase</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-resolution-phase" class="internal xref">Resolution Phase</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="auto internal xref">3.3.1</a>.  <a href="#name-longest-prefix-matching" class="internal xref">Longest-Prefix Matching</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="auto internal xref">3.3.2</a>.  <a href="#name-handling-hash-and-query-in-" class="internal xref">Handling Hash and Query in Pathname</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.3">
                    <p id="section-toc.1-1.3.2.3.2.3.1"><a href="#section-3.3.3" class="auto internal xref">3.3.3</a>.  <a href="#name-processing-matched-shortlin" class="internal xref">Processing Matched Shortlinks</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.4">
                    <p id="section-toc.1-1.3.2.3.2.4.1"><a href="#section-3.3.4" class="auto internal xref">3.3.4</a>.  <a href="#name-no-match-found" class="internal xref">No Match Found</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-construction-phase" class="internal xref">Construction Phase</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a href="#section-3.4.1" class="auto internal xref">3.4.1</a>.  <a href="#name-base-url-construction" class="internal xref">Base URL Construction</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.2">
                    <p id="section-toc.1-1.3.2.4.2.2.1"><a href="#section-3.4.2" class="auto internal xref">3.4.2</a>.  <a href="#name-query-parameter-combination" class="internal xref">Query Parameter Combination</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.3">
                    <p id="section-toc.1-1.3.2.4.2.3.1"><a href="#section-3.4.3" class="auto internal xref">3.4.3</a>.  <a href="#name-fragment-selection" class="internal xref">Fragment Selection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.4">
                    <p id="section-toc.1-1.3.2.4.2.4.1"><a href="#section-3.4.4" class="auto internal xref">3.4.4</a>.  <a href="#name-final-url-assembly" class="internal xref">Final URL Assembly</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-algorithm-pseudocode" class="internal xref">Algorithm Pseudocode</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="auto internal xref">3.6</a>.  <a href="#name-example-resolutions" class="internal xref">Example Resolutions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6.2.1">
                    <p id="section-toc.1-1.3.2.6.2.1.1"><a href="#section-3.6.1" class="auto internal xref">3.6.1</a>.  <a href="#name-example-1-absolute-destinat" class="internal xref">Example 1: Absolute Destination with Path Appending</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6.2.2">
                    <p id="section-toc.1-1.3.2.6.2.2.1"><a href="#section-3.6.2" class="auto internal xref">3.6.2</a>.  <a href="#name-example-2-internal-redirect" class="internal xref">Example 2: Internal Redirect Chain</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6.2.3">
                    <p id="section-toc.1-1.3.2.6.2.3.1"><a href="#section-3.6.3" class="auto internal xref">3.6.3</a>.  <a href="#name-example-3-query-parameter-p" class="internal xref">Example 3: Query Parameter Precedence</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6.2.4">
                    <p id="section-toc.1-1.3.2.6.2.4.1"><a href="#section-3.6.4" class="auto internal xref">3.6.4</a>.  <a href="#name-example-4-fragment-preceden" class="internal xref">Example 4: Fragment Precedence</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6.2.5">
                    <p id="section-toc.1-1.3.2.6.2.5.1"><a href="#section-3.6.5" class="auto internal xref">3.6.5</a>.  <a href="#name-example-5-no-match-returns-" class="internal xref">Example 5: No Match Returns Original</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-loop-protection" class="internal xref">Loop Protection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-input-validation" class="internal xref">Input Validation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-ruleset-source-security" class="internal xref">Ruleset Source Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-information-disclosure" class="internal xref">Information Disclosure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-path-traversal" class="internal xref">Path Traversal</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-query-parameter-and-fragmen" class="internal xref">Query Parameter and Fragment Handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-redirect-chains" class="internal xref">Redirect Chains</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Shortlinks provide a mechanism for mapping compact, memorable identifiers to
longer URLs. However, without a standardized resolution algorithm, different
implementations may resolve the same shortlink to different destinations or
handle edge cases inconsistently, leading to interoperability issues.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This document specifies a deterministic algorithm for resolving shortlinks that:<a href="#section-1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-3.1">
          <p id="section-1-3.1.1">Supports longest-prefix key matching to enable hierarchical shortlink
structures<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.2">
          <p id="section-1-3.2.1">Handles both absolute URL destinations and origin-relative internal redirects<a href="#section-1-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.3">
          <p id="section-1-3.3.1">Provides loop protection for internal redirect chains<a href="#section-1-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.4">
          <p id="section-1-3.4.1">Defines clear precedence rules for combining query parameters and fragments
from multiple sources<a href="#section-1-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.5">
          <p id="section-1-3.5.1">Remains stateless and deterministic for consistent behavior across
implementations<a href="#section-1-3.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-4">The algorithm is designed to work with any ruleset source (database, file,
configuration, etc.) and requires no protocol-level changes or IANA
registrations.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The following terms are used throughout this document:<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3"><strong>Shortlink</strong>: A compact string identifier that maps to a URL destination.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4"><strong>Ruleset</strong>: A collection of key-value pairs where keys are shortlink
identifiers (non-empty strings without leading "/") and values are either
absolute URLs (strings whose first four characters are "http") or
origin-relative paths (strings whose first character is "/").<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5"><strong>Request URL</strong>: The incoming URL to be resolved, which may contain an embedded
shortlink in its pathname component.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6"><strong>Destination URL</strong>: The fully-qualified URL that results from resolving a
shortlink.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7"><strong>Internal Redirect</strong>: A shortlink value that is an origin-relative path (whose
first character is "/"), which requires further resolution within the same
origin.<a href="#section-2-7" class="pilcrow">¶</a></p>
<p id="section-2-8"><strong>Absolute Destination</strong>: A shortlink value that is a fully-qualified URL (whose
first four characters are "http", including both "http" and "https" schemes),
which serves as the final destination.<a href="#section-2-8" class="pilcrow">¶</a></p>
<p id="section-2-9"><strong>Longest-Prefix Match</strong>: The process of finding the matching shortlink key by
starting with the full pathname (minus leading "/") and progressively removing
the trailing path segment (everything from the last "/" character onward,
inclusive of the "/") until either a matching key is found in the Ruleset or no
"/" character remains in the candidate key.<a href="#section-2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="algorithm-specification">
<section id="section-3">
      <h2 id="name-algorithm-specification">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-algorithm-specification" class="section-name selfRef">Algorithm Specification</a>
      </h2>
<div id="overview">
<section id="section-3.1">
        <h3 id="name-overview">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-3.1-1">The algorithm takes as input:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">A Request URL (a fully-qualified URL)<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">A Ruleset (a collection of shortlink mappings)<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-3">The algorithm produces as output:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1">A Destination URL (the resolved fully-qualified URL)<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-5">The algorithm operates in three main phases:<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1-6">
<li id="section-3.1-6.1">
            <p id="section-3.1-6.1.1"><strong>Initialization</strong>: Extract embedded query parameters and fragments from the
Request URL<a href="#section-3.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-6.2">
            <p id="section-3.1-6.2.1"><strong>Resolution</strong>: Find the matching shortlink using longest-prefix matching,
handling internal redirects as needed<a href="#section-3.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-6.3">
            <p id="section-3.1-6.3.1"><strong>Construction</strong>: Build the final Destination URL by combining components
according to precedence rules<a href="#section-3.1-6.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="initialization-phase">
<section id="section-3.2">
        <h3 id="name-initialization-phase">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-initialization-phase" class="section-name selfRef">Initialization Phase</a>
        </h3>
<p id="section-3.2-1">From the Request URL, extract and preserve the following components:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">
            <p id="section-3.2-2.1.1"><strong>Origin</strong>: The scheme, host, and port components of the Request URL<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.2">
            <p id="section-3.2-2.2.1"><strong>Request Query</strong>: The search component of the Request URL (including the
leading "?" if present, otherwise an empty string)<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.3">
            <p id="section-3.2-2.3.1"><strong>Request Fragment</strong>: The hash component of the Request URL (including the
leading "#" if present, otherwise an empty string)<a href="#section-3.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.4">
            <p id="section-3.2-2.4.1"><strong>Pathname</strong>: The pathname component of the Request URL (the path portion,
including the leading "/")<a href="#section-3.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-3">These preserved components will be used during final URL construction according
to the precedence rules defined below. Initialize the following variables:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">
            <p id="section-3.2-4.1.1"><code>relativePathname</code> = "" (empty string)<a href="#section-3.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-4.2">
            <p id="section-3.2-4.2.1"><code>initialQuery</code> = "" (empty string)<a href="#section-3.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-4.3">
            <p id="section-3.2-4.3.1"><code>initialHash</code> = "" (empty string)<a href="#section-3.2-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-4.4">
            <p id="section-3.2-4.4.1"><code>redirectCount</code> = 0<a href="#section-3.2-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="resolution-phase">
<section id="section-3.3">
        <h3 id="name-resolution-phase">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-resolution-phase" class="section-name selfRef">Resolution Phase</a>
        </h3>
<p id="section-3.3-1">The resolution process begins with the pathname from the Request URL and
searches for a matching shortlink key using longest-prefix matching.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="longest-prefix-matching">
<section id="section-3.3.1">
          <h4 id="name-longest-prefix-matching">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-longest-prefix-matching" class="section-name selfRef">Longest-Prefix Matching</a>
          </h4>
<p id="section-3.3.1-1">At the start of each resolution iteration, find a matching shortlink key using
the following procedure:<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3.1-2">
<li id="section-3.3.1-2.1">
              <p id="section-3.3.1-2.1.1">Let <code>candidate</code> = <code>pathname.slice(1)</code> (the pathname with the leading "/"
character removed). If pathname is exactly "/", then <code>candidate</code> = "" (empty
string).<a href="#section-3.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.3.1-2.2">
              <p id="section-3.3.1-2.2.1">Check if <code>candidate</code> exists as a key in the Ruleset:<a href="#section-3.3.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.1-2.2.2.1">
                  <p id="section-3.3.1-2.2.2.1.1">If yes, <code>matchedKey</code> = <code>candidate</code>, proceed to "Processing Matched
Shortlinks"<a href="#section-3.3.1-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.3.1-2.2.2.2">
                  <p id="section-3.3.1-2.2.2.2.1">If no, continue to step 3<a href="#section-3.3.1-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-3.3.1-2.3">
              <p id="section-3.3.1-2.3.1">While <code>candidate.length &gt; 0</code>: a. Find the last occurrence of "/" in
<code>candidate</code> using <code>candidate.lastIndexOf("/")</code> b. If no "/" is found (result
is -1), exit the loop, no match found c. Set <code>candidate</code> =
<code>candidate.slice(0, slashIndex)</code> (everything before the last "/", exclusive)
d. Check if <code>candidate</code> exists as a key in the Ruleset:<a href="#section-3.3.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.1-2.3.2.1">
                  <p id="section-3.3.1-2.3.2.1.1">If yes, <code>matchedKey</code> = <code>candidate</code>, proceed to "Processing Matched
Shortlinks"<a href="#section-3.3.1-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.3.1-2.3.2.2">
                  <p id="section-3.3.1-2.3.2.2.1">If no, repeat step 3<a href="#section-3.3.1-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ol>
<p id="section-3.3.1-3">If no matching key is found after this process completes, the algorithm
terminates and returns the Request URL with any accumulated relativePathname
appended (see "No Match Found" below).<a href="#section-3.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handling-hash-and-query-in-pathname">
<section id="section-3.3.2">
          <h4 id="name-handling-hash-and-query-in-">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-handling-hash-and-query-in-" class="section-name selfRef">Handling Hash and Query in Pathname</a>
          </h4>
<p id="section-3.3.2-1">At the start of each resolution iteration (before longest-prefix matching), if
the pathname contains "#" or "?" characters, these <span class="bcp14">MUST</span> be extracted and removed
from the pathname. The extraction <span class="bcp14">MUST</span> occur in the following order:<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3.2-2">
<li id="section-3.3.2-2.1">
              <p id="section-3.3.2-2.1.1"><strong>Hash Extraction</strong> (performed first):<a href="#section-3.3.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-2.1.2.1">
                  <p id="section-3.3.2-2.1.2.1.1">Find the last occurrence of "#" in <code>pathname</code> using
<code>pathname.lastIndexOf("#")</code><a href="#section-3.3.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.3.2-2.1.2.2">
                  <p id="section-3.3.2-2.1.2.2.1">If found (result &gt;= 0):<a href="#section-3.3.2-2.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-2.1.2.2.2.1">
                      <p id="section-3.3.2-2.1.2.2.2.1.1">If <code>initialHash</code> is empty (""), set <code>initialHash</code> =
<code>pathname.slice(hashIdx)</code> (everything from "#" onward, inclusive)<a href="#section-3.3.2-2.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-3.3.2-2.1.2.2.2.2">
                      <p id="section-3.3.2-2.1.2.2.2.2.1">Set <code>pathname</code> = <code>pathname.slice(0, hashIdx)</code> (everything before "#",
exclusive)<a href="#section-3.3.2-2.1.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li id="section-3.3.2-2.2">
              <p id="section-3.3.2-2.2.1"><strong>Query Extraction</strong> (performed after hash extraction):<a href="#section-3.3.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-2.2.2.1">
                  <p id="section-3.3.2-2.2.2.1.1">Find the last occurrence of "?" in the updated <code>pathname</code> using
<code>pathname.lastIndexOf("?")</code><a href="#section-3.3.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.3.2-2.2.2.2">
                  <p id="section-3.3.2-2.2.2.2.1">If found (result &gt;= 0):<a href="#section-3.3.2-2.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-2.2.2.2.2.1">
                      <p id="section-3.3.2-2.2.2.2.2.1.1">If <code>initialQuery</code> is empty (""), set <code>initialQuery</code> =
<code>pathname.slice(queryIdx)</code> (everything from "?" onward, inclusive)<a href="#section-3.3.2-2.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-3.3.2-2.2.2.2.2.2">
                      <p id="section-3.3.2-2.2.2.2.2.2.1">Set <code>pathname</code> = <code>pathname.slice(0, queryIdx)</code> (everything before "?",
exclusive)<a href="#section-3.3.2-2.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
          </ol>
<p id="section-3.3.2-3">After extraction, the pathname contains only path segments and is used for
longest-prefix matching. The extracted hash and query are preserved in
<code>initialHash</code> and <code>initialQuery</code> (only the first extraction of each is preserved
across iterations).<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-matched-shortlinks">
<section id="section-3.3.3">
          <h4 id="name-processing-matched-shortlin">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-processing-matched-shortlin" class="section-name selfRef">Processing Matched Shortlinks</a>
          </h4>
<p id="section-3.3.3-1">When a matching key <code>matchedKey</code> is found in the Ruleset:<a href="#section-3.3.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3.3-2">
<li id="section-3.3.3-2.1">
              <p id="section-3.3.3-2.1.1">Let <code>value</code> = the value associated with <code>matchedKey</code> in the Ruleset<a href="#section-3.3.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.3.3-2.2">
              <p id="section-3.3.3-2.2.1">Calculate the remaining pathname segment:<a href="#section-3.3.3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.3-2.2.2.1">
                  <p id="section-3.3.3-2.2.2.1.1">After removing the leading "/" from pathname and matching against
<code>matchedKey</code>, the remaining segment is calculated as: <code>remainingPath</code> =
<code>pathname.slice(matchedKey.length + 1)</code> where <code>matchedKey.length + 1</code>
accounts for the matched key and the "/" that follows it (or would follow
it). This extracts everything from index <code>matchedKey.length + 1</code> to the end
of the pathname string.<a href="#section-3.3.3-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.3.3-2.2.2.2">
                  <p id="section-3.3.3-2.2.2.2.1">If <code>pathname.length &lt;= matchedKey.length + 1</code>, then <code>remainingPath</code> = ""
(empty string), meaning the pathname ended exactly at or before the end of
the matched key.<a href="#section-3.3.3-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.3.3-2.2.2.3">
                  <p id="section-3.3.3-2.2.2.3.1">Prepend <code>remainingPath</code> to <code>relativePathname</code>: <code>relativePathname</code> =
<code>remainingPath + relativePathname</code> (string concatenation, preserving any
leading "/" in <code>remainingPath</code>)<a href="#section-3.3.3-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-3.3.3-2.3">
              <p id="section-3.3.3-2.3.1">Determine the value type:<a href="#section-3.3.3-2.3.1" class="pilcrow">¶</a></p>
<p id="section-3.3.3-2.3.2"><strong>Absolute Destination</strong> (first four characters of <code>value</code> are "http"):
- Parse <code>value</code> as a URL to obtain <code>destination</code> URL object
- Resolution terminates immediately
- Construct final URL (see "Construction Phase" below)<a href="#section-3.3.3-2.3.2" class="pilcrow">¶</a></p>
<p id="section-3.3.3-2.3.3"><strong>Internal Redirect</strong> (first character of <code>value</code> is "/"):
- Set <code>pathname</code> = <code>value</code> (the shortlink value becomes the new pathname)
- Increment <code>redirectCount</code> by 1
- If <code>redirectCount</code> &gt;= 256, terminate with error "too many internal
  redirects"
- Continue to next resolution iteration (return to "Handling Hash and Query
  in Pathname" at the start of the iteration)<a href="#section-3.3.3-2.3.3" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="no-match-found">
<section id="section-3.3.4">
          <h4 id="name-no-match-found">
<a href="#section-3.3.4" class="section-number selfRef">3.3.4. </a><a href="#name-no-match-found" class="section-name selfRef">No Match Found</a>
          </h4>
<p id="section-3.3.4-1">If no matching key is found during longest-prefix matching:<a href="#section-3.3.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.4-2.1">
              <p id="section-3.3.4-2.1.1">Construct a destination URL using
<code>new URL(pathname + relativePathname, origin)</code> where <code>origin</code> is the Request
URL origin<a href="#section-3.3.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.4-2.2">
              <p id="section-3.3.4-2.2.1">This destination URL's pathname becomes the final destination pathname<a href="#section-3.3.4-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.4-2.3">
              <p id="section-3.3.4-2.3.1">Proceed to "Construction Phase" with this destination URL<a href="#section-3.3.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="construction-phase">
<section id="section-3.4">
        <h3 id="name-construction-phase">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-construction-phase" class="section-name selfRef">Construction Phase</a>
        </h3>
<p id="section-3.4-1">After resolution completes (either by finding an absolute destination or no
match), construct the final Destination URL using the following procedure:<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<div id="base-url-construction">
<section id="section-3.4.1">
          <h4 id="name-base-url-construction">
<a href="#section-3.4.1" class="section-number selfRef">3.4.1. </a><a href="#name-base-url-construction" class="section-name selfRef">Base URL Construction</a>
          </h4>
<p id="section-3.4.1-1">The base URL components are determined as follows:<a href="#section-3.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4.1-2.1">
              <p id="section-3.4.1-2.1.1"><strong>Origin</strong>:<a href="#section-3.4.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4.1-2.1.2.1">
                  <p id="section-3.4.1-2.1.2.1.1">If an absolute destination was found: use the origin from the parsed
destination URL<a href="#section-3.4.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.4.1-2.1.2.2">
                  <p id="section-3.4.1-2.1.2.2.1">Otherwise (no match found): use the Request URL origin<a href="#section-3.4.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-3.4.1-2.2">
              <p id="section-3.4.1-2.2.1"><strong>Pathname</strong>:<a href="#section-3.4.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4.1-2.2.2.1">
                  <p id="section-3.4.1-2.2.2.1.1">If an absolute destination was found: start with the destination URL's
pathname component (without leading/trailing modification)<a href="#section-3.4.1-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.4.1-2.2.2.2">
                  <p id="section-3.4.1-2.2.2.2.1">Otherwise: use the pathname from the constructed URL in "No Match Found"<a href="#section-3.4.1-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.4.1-2.2.2.3">
                  <p id="section-3.4.1-2.2.2.3.1">In both cases: append <code>relativePathname</code> directly (string concatenation)
without any separator, as <code>relativePathname</code> already includes any necessary
leading "/"<a href="#section-3.4.1-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="query-parameter-combination">
<section id="section-3.4.2">
          <h4 id="name-query-parameter-combination">
<a href="#section-3.4.2" class="section-number selfRef">3.4.2. </a><a href="#name-query-parameter-combination" class="section-name selfRef">Query Parameter Combination</a>
          </h4>
<p id="section-3.4.2-1">Query parameters <span class="bcp14">MUST</span> be combined using the following procedure and precedence
order (higher precedence overwrites lower precedence for matching parameter
names):<a href="#section-3.4.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.4.2-2">
<li id="section-3.4.2-2.1">
              <p id="section-3.4.2-2.1.1"><strong>Base query</strong>: Start with an empty URLSearchParams object<a href="#section-3.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.4.2-2.2">
              <p id="section-3.4.2-2.2.1"><strong>Add destination query</strong> (lowest precedence): If an absolute destination was
found, parse <code>destination.search</code> (the destination URL's search component,
including leading "?" if present) as URLSearchParams and add all parameters
to the base<a href="#section-3.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.4.2-2.3">
              <p id="section-3.4.2-2.3.1"><strong>Add pathname-embedded query</strong> (medium precedence): If <code>initialQuery</code> is not
empty, parse it (including leading "?" if present) as URLSearchParams and for
each key-value pair, call <code>URLSearchParams.set(key, value)</code> on the base (this
overwrites any existing parameters with the same key)<a href="#section-3.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.4.2-2.4">
              <p id="section-3.4.2-2.4.1"><strong>Add Request URL query</strong> (highest precedence): If <code>requestQuery</code> is not
empty, parse it (including leading "?" if present) as URLSearchParams and for
each key-value pair, call <code>URLSearchParams.set(key, value)</code> on the base (this
overwrites any existing parameters with the same key)<a href="#section-3.4.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-3.4.2-3">Convert the final URLSearchParams to a string using
<code>URLSearchParams.toString()</code>. If the result is non-empty, prefix it with "?" to
form the final query string. Otherwise, the query string is "" (empty string).<a href="#section-3.4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fragment-selection">
<section id="section-3.4.3">
          <h4 id="name-fragment-selection">
<a href="#section-3.4.3" class="section-number selfRef">3.4.3. </a><a href="#name-fragment-selection" class="section-name selfRef">Fragment Selection</a>
          </h4>
<p id="section-3.4.3-1">Fragment values <span class="bcp14">MUST</span> be selected using the following precedence (higher
precedence replaces lower precedence):<a href="#section-3.4.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.4.3-2">
<li id="section-3.4.3-2.1">
              <p id="section-3.4.3-2.1.1"><strong>Request URL fragment</strong> (highest precedence): If <code>requestHash</code> is not empty,
use <code>requestHash</code> (which includes the leading "#")<a href="#section-3.4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.4.3-2.2">
              <p id="section-3.4.3-2.2.1"><strong>Pathname-embedded fragment</strong> (medium precedence): If <code>requestHash</code> is empty
and <code>initialHash</code> is not empty, use <code>initialHash</code> (which includes the leading
"#")<a href="#section-3.4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.4.3-2.3">
              <p id="section-3.4.3-2.3.1"><strong>Destination URL fragment</strong> (lowest precedence): If both <code>requestHash</code> and
<code>initialHash</code> are empty and an absolute destination was found, use
<code>destination.hash</code> (which includes the leading "#" if present, otherwise "")<a href="#section-3.4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.4.3-2.4">
              <p id="section-3.4.3-2.4.1"><strong>No fragment</strong>: If none of the above apply, use "" (empty string)<a href="#section-3.4.3-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-3.4.3-3">Unlike query parameters, fragments are not merged; only one fragment value is
used based on the precedence order above.<a href="#section-3.4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="final-url-assembly">
<section id="section-3.4.4">
          <h4 id="name-final-url-assembly">
<a href="#section-3.4.4" class="section-number selfRef">3.4.4. </a><a href="#name-final-url-assembly" class="section-name selfRef">Final URL Assembly</a>
          </h4>
<p id="section-3.4.4-1">Assemble the final Destination URL by concatenating the following components in
order:<a href="#section-3.4.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4.4-2"><code>
{origin}{destination-pathname}{relativePathname}{query-string}{fragment-string}
</code><a href="#section-3.4.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4.4-3">Where:<a href="#section-3.4.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4.4-4.1">
              <p id="section-3.4.4-4.1.1"><code>{origin}</code> is the scheme, host, and port (e.g., "https://example.com")<a href="#section-3.4.4-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.4.4-4.2">
              <p id="section-3.4.4-4.2.1"><code>{destination-pathname}</code> is the pathname component from the destination (e.g.,
"/path/to")<a href="#section-3.4.4-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.4.4-4.3">
              <p id="section-3.4.4-4.3.1"><code>{relativePathname}</code> is the accumulated relative pathname (e.g.,
"/extra/segments")<a href="#section-3.4.4-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.4.4-4.4">
              <p id="section-3.4.4-4.4.1"><code>{query-string}</code> is the combined query string from "Query Parameter
Combination" (e.g., "?foo=bar" or "")<a href="#section-3.4.4-4.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.4.4-4.5">
              <p id="section-3.4.4-4.5.1"><code>{fragment-string}</code> is the selected fragment from "Fragment Selection" (e.g.,
"#section" or "")<a href="#section-3.4.4-4.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3.4.4-5">No additional separators are inserted between components beyond what is already
present in the component values themselves.<a href="#section-3.4.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="algorithm-pseudocode">
<section id="section-3.5">
        <h3 id="name-algorithm-pseudocode">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-algorithm-pseudocode" class="section-name selfRef">Algorithm Pseudocode</a>
        </h3>
<p id="section-3.5-1">The following pseudocode summarizes the algorithm:<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">```
function resolve(RequestURL, Ruleset):
  // Initialize variables
  origin = RequestURL.origin
  requestQuery = RequestURL.search  // Includes "?" if present, else ""
  requestHash = RequestURL.hash     // Includes "#" if present, else ""
  pathname = RequestURL.pathname    // Always starts with "/"<a href="#section-3.5-2" class="pilcrow">¶</a></p>
<p id="section-3.5-3">relativePathname = ""
  initialQuery = ""
  initialHash = ""
  redirectCount = 0
  matchedKey = null  // Initialize to null/undefined<a href="#section-3.5-3" class="pilcrow">¶</a></p>
<p id="section-3.5-4">while redirectCount &lt; 256:
    matchedKey = null  // Reset for each iteration<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.5-5">
<pre>
// Step 1: Extract embedded hash from pathname (first)
hashIdx = pathname.lastIndexOf("#")
if hashIdx &gt;= 0:
  if initialHash == "":
    initialHash = pathname.slice(hashIdx)  // From "#" onward, inclusive
  pathname = pathname.slice(0, hashIdx)    // Before "#", exclusive

// Step 2: Extract embedded query from pathname (after hash)
queryIdx = pathname.lastIndexOf("?")
if queryIdx &gt;= 0:
  if initialQuery == "":
    initialQuery = pathname.slice(queryIdx)  // From "?" onward, inclusive
  pathname = pathname.slice(0, queryIdx)     // Before "?", exclusive

// Step 3: Longest-prefix match
if pathname == "/":
  candidate = ""
else:
  candidate = pathname.slice(1)  // Remove leading "/"

// Try exact match first
if candidate != "" and Ruleset.hasOwnProperty(candidate):
  matchedKey = candidate
else:
  // Try progressively shorter prefixes
  while candidate.length &gt; 0:
    slashIdx = candidate.lastIndexOf("/")
    if slashIdx == -1:
      break  // No more "/" found, no match
    candidate = candidate.slice(0, slashIdx)  // Remove last segment
    if Ruleset.hasOwnProperty(candidate):
      matchedKey = candidate
      break

// Step 4: Process match result
if matchedKey == null:
  // No match found
  destination = new URL(pathname + relativePathname, origin)
  query = combineQueries("", initialQuery, requestQuery)
  hash = selectFragment(requestHash, initialHash, "")
  return destination.origin + destination.pathname + query + hash

// Match found, process it
value = Ruleset[matchedKey]

// Calculate remaining path
if pathname.length &gt; matchedKey.length + 1:
  remainingPath = pathname.slice(matchedKey.length + 1)
else:
  remainingPath = ""
relativePathname = remainingPath + relativePathname

// Check value type
if value.slice(0, 4) == "http":
  // Absolute destination
  destination = new URL(value)
  query = combineQueries(destination.search, initialQuery, requestQuery)
  hash = selectFragment(requestHash, initialHash, destination.hash)
  return destination.origin + destination.pathname +
         relativePathname + query + hash

if value.length &gt; 0 and value[0] == "/":
  // Internal redirect
  pathname = value
  redirectCount++
  continue  // Next iteration
</pre><a href="#section-3.5-5" class="pilcrow">¶</a>
</div>
<p id="section-3.5-6">// Loop limit exceeded
  throw Error("too many internal redirects")<a href="#section-3.5-6" class="pilcrow">¶</a></p>
<p id="section-3.5-7">function combineQueries(baseQuery, pathnameQuery, requestQuery):
  // baseQuery is lowest precedence (destination query)
  // pathnameQuery is medium precedence
  // requestQuery is highest precedence<a href="#section-3.5-7" class="pilcrow">¶</a></p>
<p id="section-3.5-8">params = new URLSearchParams(baseQuery)<a href="#section-3.5-8" class="pilcrow">¶</a></p>
<p id="section-3.5-9">// Add pathname-embedded query (overwrites base)
  if pathnameQuery != "":
    pathParams = new URLSearchParams(pathnameQuery)
    for each key-value pair (key, value) in pathParams:
      params.set(key, value)<a href="#section-3.5-9" class="pilcrow">¶</a></p>
<p id="section-3.5-10">// Add request query (overwrites base and pathname)
  if requestQuery != "":
    requestParams = new URLSearchParams(requestQuery)
    for each key-value pair (key, value) in requestParams:
      params.set(key, value)<a href="#section-3.5-10" class="pilcrow">¶</a></p>
<p id="section-3.5-11">result = params.toString()
  return result.length &gt; 0 ? "?" + result : ""<a href="#section-3.5-11" class="pilcrow">¶</a></p>
<p id="section-3.5-12">function selectFragment(requestHash, initialHash, destinationHash):
  if requestHash != "":
    return requestHash
  if initialHash != "":
    return initialHash
  return destinationHash  // May be "" if destination has no fragment
```<a href="#section-3.5-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-resolutions">
<section id="section-3.6">
        <h3 id="name-example-resolutions">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-example-resolutions" class="section-name selfRef">Example Resolutions</a>
        </h3>
<div id="example-1-absolute-destination-with-path-appending">
<section id="section-3.6.1">
          <h4 id="name-example-1-absolute-destinat">
<a href="#section-3.6.1" class="section-number selfRef">3.6.1. </a><a href="#name-example-1-absolute-destinat" class="section-name selfRef">Example 1: Absolute Destination with Path Appending</a>
          </h4>
<p id="section-3.6.1-1">Ruleset:<a href="#section-3.6.1-1" class="pilcrow">¶</a></p>
<p id="section-3.6.1-2"><code>json
{
  "github": "https://github.com",
  "repo": "https://github.com/FartLabs/go"
}
</code><a href="#section-3.6.1-2" class="pilcrow">¶</a></p>
<p id="section-3.6.1-3">Request: <code>https://example.com/github/ietf/guidelines</code><a href="#section-3.6.1-3" class="pilcrow">¶</a></p>
<p id="section-3.6.1-4">Resolution:<a href="#section-3.6.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6.1-5">
<li id="section-3.6.1-5.1">
              <p id="section-3.6.1-5.1.1">Pathname "/github/ietf/guidelines" - remove leading "/" to get candidate
"github/ietf/guidelines"<a href="#section-3.6.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.2">
              <p id="section-3.6.1-5.2.1">Check Ruleset for "github/ietf/guidelines" - not found<a href="#section-3.6.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.3">
              <p id="section-3.6.1-5.3.1">Find last "/" at index 6, candidate becomes "github"<a href="#section-3.6.1-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.4">
              <p id="section-3.6.1-5.4.1">Check Ruleset for "github" - found: value "https://github.com"<a href="#section-3.6.1-5.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.5">
              <p id="section-3.6.1-5.5.1">Calculate remainingPath: pathname is "/github/ietf/guidelines", matchedKey is
"github" (length 6), so pathname.slice(matchedKey.length + 1) =
pathname.slice(7) = "/ietf/guidelines" (from index 7, which is the "/" after
"github")<a href="#section-3.6.1-5.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.6">
              <p id="section-3.6.1-5.6.1">relativePathname = "/ietf/guidelines" + "" = "/ietf/guidelines"<a href="#section-3.6.1-5.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.7">
              <p id="section-3.6.1-5.7.1">Value starts with "http" → absolute destination<a href="#section-3.6.1-5.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.8">
              <p id="section-3.6.1-5.8.1">Parse "https://github.com" as URL: origin = "https://github.com", pathname =
"/"<a href="#section-3.6.1-5.8.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.9">
              <p id="section-3.6.1-5.9.1">Query: "" (no queries), Fragment: "" (no fragments)<a href="#section-3.6.1-5.9.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.1-5.10">
              <p id="section-3.6.1-5.10.1">Result: <code>https://github.com</code> + <code>/</code> + <code>/ietf/guidelines</code> + <code>+</code> =
<code>https://github.com/ietf/guidelines</code><a href="#section-3.6.1-5.10.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="example-2-internal-redirect-chain">
<section id="section-3.6.2">
          <h4 id="name-example-2-internal-redirect">
<a href="#section-3.6.2" class="section-number selfRef">3.6.2. </a><a href="#name-example-2-internal-redirect" class="section-name selfRef">Example 2: Internal Redirect Chain</a>
          </h4>
<p id="section-3.6.2-1">Ruleset:<a href="#section-3.6.2-1" class="pilcrow">¶</a></p>
<p id="section-3.6.2-2"><code>json
{
  "docs": "/documentation",
  "docs/api": "/documentation/reference"
}
</code><a href="#section-3.6.2-2" class="pilcrow">¶</a></p>
<p id="section-3.6.2-3">Request: <code>https://example.com/docs/api/v1/users</code><a href="#section-3.6.2-3" class="pilcrow">¶</a></p>
<p id="section-3.6.2-4">Resolution: <strong>Iteration 1:</strong><a href="#section-3.6.2-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6.2-5">
<li id="section-3.6.2-5.1">
              <p id="section-3.6.2-5.1.1">Pathname "/docs/api/v1/users" - remove leading "/" to get candidate
"docs/api/v1/users"<a href="#section-3.6.2-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.2">
              <p id="section-3.6.2-5.2.1">Check Ruleset for "docs/api/v1/users" - not found<a href="#section-3.6.2-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.3">
              <p id="section-3.6.2-5.3.1">Find last "/" at index 8, candidate becomes "docs/api"<a href="#section-3.6.2-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.4">
              <p id="section-3.6.2-5.4.1">Check Ruleset for "docs/api" - found: value "/documentation/reference"<a href="#section-3.6.2-5.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.5">
              <p id="section-3.6.2-5.5.1">Calculate remainingPath: pathname.slice(8 + 1) = pathname.slice(9) =
"/v1/users"<a href="#section-3.6.2-5.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.6">
              <p id="section-3.6.2-5.6.1">relativePathname = "/v1/users" + "" = "/v1/users"<a href="#section-3.6.2-5.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.7">
              <p id="section-3.6.2-5.7.1">Value starts with "/" → internal redirect<a href="#section-3.6.2-5.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-5.8">
              <p id="section-3.6.2-5.8.1">pathname = "/documentation/reference", redirectCount = 1<a href="#section-3.6.2-5.8.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-3.6.2-6"><strong>Iteration 2:</strong><a href="#section-3.6.2-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6.2-7">
<li id="section-3.6.2-7.1">
              <p id="section-3.6.2-7.1.1">Pathname "/documentation/reference" - remove leading "/" to get candidate
"documentation/reference"<a href="#section-3.6.2-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.2">
              <p id="section-3.6.2-7.2.1">Check Ruleset for "documentation/reference" - not found<a href="#section-3.6.2-7.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.3">
              <p id="section-3.6.2-7.3.1">Find last "/" at index 13, candidate becomes "documentation"<a href="#section-3.6.2-7.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.4">
              <p id="section-3.6.2-7.4.1">Check Ruleset for "documentation" - not found<a href="#section-3.6.2-7.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.5">
              <p id="section-3.6.2-7.5.1">Find last "/" at index -1 (no "/" in "documentation") - no match found<a href="#section-3.6.2-7.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.6">
              <p id="section-3.6.2-7.6.1">Construct destination: new URL("/documentation/reference" + "/v1/users",
origin)<a href="#section-3.6.2-7.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.7">
              <p id="section-3.6.2-7.7.1">Query: "" (no queries), Fragment: "" (no fragments)<a href="#section-3.6.2-7.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.2-7.8">
              <p id="section-3.6.2-7.8.1">Result: <code>https://example.com/documentation/reference/v1/users</code><a href="#section-3.6.2-7.8.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="example-3-query-parameter-precedence">
<section id="section-3.6.3">
          <h4 id="name-example-3-query-parameter-p">
<a href="#section-3.6.3" class="section-number selfRef">3.6.3. </a><a href="#name-example-3-query-parameter-p" class="section-name selfRef">Example 3: Query Parameter Precedence</a>
          </h4>
<p id="section-3.6.3-1">Ruleset:<a href="#section-3.6.3-1" class="pilcrow">¶</a></p>
<p id="section-3.6.3-2"><code>json
{
  "example": "https://example.com?baz=qux"
}
</code><a href="#section-3.6.3-2" class="pilcrow">¶</a></p>
<p id="section-3.6.3-3">Request: <code>https://example.com/example?foo=bar</code><a href="#section-3.6.3-3" class="pilcrow">¶</a></p>
<p id="section-3.6.3-4">Resolution:<a href="#section-3.6.3-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6.3-5">
<li id="section-3.6.3-5.1">
              <p id="section-3.6.3-5.1.1">Pathname "/example" - remove leading "/" to get candidate "example"<a href="#section-3.6.3-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.3-5.2">
              <p id="section-3.6.3-5.2.1">Match found: key "example", value "https://example.com?baz=qux"<a href="#section-3.6.3-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.3-5.3">
              <p id="section-3.6.3-5.3.1">No remaining pathname (matchedKey.length + 1 = 8, pathname.length = 8, so
remainingPath = "")<a href="#section-3.6.3-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.3-5.4">
              <p id="section-3.6.3-5.4.1">Value starts with "http" → absolute destination<a href="#section-3.6.3-5.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.3-5.5">
              <p id="section-3.6.3-5.5.1">Parse "https://example.com?baz=qux" as URL: destination.search = "?baz=qux"<a href="#section-3.6.3-5.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.3-5.6">
              <p id="section-3.6.3-5.6.1">Combine queries:<a href="#section-3.6.3-5.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.6.3-5.6.2.1">
                  <p id="section-3.6.3-5.6.2.1.1">Base (destination): baz=qux<a href="#section-3.6.3-5.6.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.6.3-5.6.2.2">
                  <p id="section-3.6.3-5.6.2.2.1">Pathname-embedded: (none, initialQuery = "")<a href="#section-3.6.3-5.6.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.6.3-5.6.2.3">
                  <p id="section-3.6.3-5.6.2.3.1">Request: foo=bar (overwrites any existing foo, but baz remains)<a href="#section-3.6.3-5.6.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-3.6.3-5.6.2.4">
                  <p id="section-3.6.3-5.6.2.4.1">Result: "?baz=qux&amp;foo=bar"<a href="#section-3.6.3-5.6.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-3.6.3-5.7">
              <p id="section-3.6.3-5.7.1">Fragment: requestHash = "" (no fragment in request), initialHash = "",
destinationHash = ""<a href="#section-3.6.3-5.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.3-5.8">
              <p id="section-3.6.3-5.8.1">Result: <code>https://example.com/?baz=qux&amp;foo=bar</code><a href="#section-3.6.3-5.8.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="example-4-fragment-precedence">
<section id="section-3.6.4">
          <h4 id="name-example-4-fragment-preceden">
<a href="#section-3.6.4" class="section-number selfRef">3.6.4. </a><a href="#name-example-4-fragment-preceden" class="section-name selfRef">Example 4: Fragment Precedence</a>
          </h4>
<p id="section-3.6.4-1">Ruleset:<a href="#section-3.6.4-1" class="pilcrow">¶</a></p>
<p id="section-3.6.4-2"><code>json
{
  "example": "https://example.com#yin"
}
</code><a href="#section-3.6.4-2" class="pilcrow">¶</a></p>
<p id="section-3.6.4-3">Request: <code>https://example.com/example#yang</code><a href="#section-3.6.4-3" class="pilcrow">¶</a></p>
<p id="section-3.6.4-4">Resolution:<a href="#section-3.6.4-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6.4-5">
<li id="section-3.6.4-5.1">
              <p id="section-3.6.4-5.1.1">Pathname "/example" - remove leading "/" to get candidate "example"<a href="#section-3.6.4-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.2">
              <p id="section-3.6.4-5.2.1">Match found: key "example", value "https://example.com#yin"<a href="#section-3.6.4-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.3">
              <p id="section-3.6.4-5.3.1">No remaining pathname (matchedKey.length + 1 = 8, pathname.length = 8, so
remainingPath = "")<a href="#section-3.6.4-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.4">
              <p id="section-3.6.4-5.4.1">Value starts with "http" → absolute destination<a href="#section-3.6.4-5.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.5">
              <p id="section-3.6.4-5.5.1">Parse "https://example.com#yin" as URL: destination.hash = "#yin"<a href="#section-3.6.4-5.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.6">
              <p id="section-3.6.4-5.6.1">Query: no query parameters present, result = ""<a href="#section-3.6.4-5.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.7">
              <p id="section-3.6.4-5.7.1">Fragment selection: requestHash = "#yang" (not empty) → use "#yang"<a href="#section-3.6.4-5.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.4-5.8">
              <p id="section-3.6.4-5.8.1">Result: <code>https://example.com/#yang</code><a href="#section-3.6.4-5.8.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="example-5-no-match-returns-original">
<section id="section-3.6.5">
          <h4 id="name-example-5-no-match-returns-">
<a href="#section-3.6.5" class="section-number selfRef">3.6.5. </a><a href="#name-example-5-no-match-returns-" class="section-name selfRef">Example 5: No Match Returns Original</a>
          </h4>
<p id="section-3.6.5-1">Ruleset:<a href="#section-3.6.5-1" class="pilcrow">¶</a></p>
<p id="section-3.6.5-2"><code>json
{
  "c": "https://example.com/calendar"
}
</code><a href="#section-3.6.5-2" class="pilcrow">¶</a></p>
<p id="section-3.6.5-3">Request: <code>https://example.com/colors</code><a href="#section-3.6.5-3" class="pilcrow">¶</a></p>
<p id="section-3.6.5-4">Resolution:<a href="#section-3.6.5-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6.5-5">
<li id="section-3.6.5-5.1">
              <p id="section-3.6.5-5.1.1">Pathname "/colors" - remove leading "/" to get candidate "colors"<a href="#section-3.6.5-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.5-5.2">
              <p id="section-3.6.5-5.2.1">Check Ruleset for "colors" - not found<a href="#section-3.6.5-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.5-5.3">
              <p id="section-3.6.5-5.3.1">Find last "/" in "colors" - not found (lastIndexOf returns -1)<a href="#section-3.6.5-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.5-5.4">
              <p id="section-3.6.5-5.4.1">No matching key found<a href="#section-3.6.5-5.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.5-5.5">
              <p id="section-3.6.5-5.5.1">Construct destination: new URL("/colors" + "", origin) =
"https://example.com/colors"<a href="#section-3.6.5-5.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.5-5.6">
              <p id="section-3.6.5-5.6.1">Query: "" (no queries), Fragment: "" (no fragments)<a href="#section-3.6.5-5.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.6.5-5.7">
              <p id="section-3.6.5-5.7.1">Result: <code>https://example.com/colors</code> (unchanged)<a href="#section-3.6.5-5.7.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-4">
      <h2 id="name-security-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="loop-protection">
<section id="section-4.1">
        <h3 id="name-loop-protection">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-loop-protection" class="section-name selfRef">Loop Protection</a>
        </h3>
<p id="section-4.1-1">The algorithm includes protection against infinite redirect loops by limiting
internal redirects to 256 iterations. Implementations <span class="bcp14">MUST</span> enforce this limit
and <span class="bcp14">MUST</span> reject requests that exceed it. However, 256 may be insufficient for
legitimate deeply-nested redirect structures; implementers should consider
logging or monitoring redirect counts to identify potentially problematic
rulesets.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-validation">
<section id="section-4.2">
        <h3 id="name-input-validation">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-input-validation" class="section-name selfRef">Input Validation</a>
        </h3>
<p id="section-4.2-1">Implementations <span class="bcp14">SHOULD</span> validate that:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">
            <p id="section-4.2-2.1.1">Request URLs are well-formed and use supported schemes<a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.2">
            <p id="section-4.2-2.2.1">Ruleset values are valid URLs or paths<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.3">
            <p id="section-4.2-2.3.1">Pathname components do not contain illegal characters<a href="#section-4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-3">Malformed input may cause unpredictable behavior or security vulnerabilities.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ruleset-source-security">
<section id="section-4.3">
        <h3 id="name-ruleset-source-security">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-ruleset-source-security" class="section-name selfRef">Ruleset Source Security</a>
        </h3>
<p id="section-4.3-1">The security of the resolution algorithm depends on the trustworthiness of the
ruleset source. Implementations <span class="bcp14">SHOULD</span>:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">
            <p id="section-4.3-2.1.1">Validate ruleset integrity (e.g., checksums, signatures)<a href="#section-4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.2">
            <p id="section-4.3-2.2.1">Restrict ruleset modifications to authorized entities<a href="#section-4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.3">
            <p id="section-4.3-2.3.1">Audit ruleset changes for suspicious patterns<a href="#section-4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.4">
            <p id="section-4.3-2.4.1">Implement rate limiting on resolution requests to prevent abuse<a href="#section-4.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="information-disclosure">
<section id="section-4.4">
        <h3 id="name-information-disclosure">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-information-disclosure" class="section-name selfRef">Information Disclosure</a>
        </h3>
<p id="section-4.4-1">The resolution process may reveal information about the ruleset structure
through timing differences or error messages. Implementations <span class="bcp14">SHOULD</span> consider:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Using constant-time matching algorithms where timing attacks are a concern<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">Providing uniform error responses that don't reveal whether a shortlink key
exists<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="path-traversal">
<section id="section-4.5">
        <h3 id="name-path-traversal">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-path-traversal" class="section-name selfRef">Path Traversal</a>
        </h3>
<p id="section-4.5-1">When appending relative pathname segments to destination URLs, implementations
<span class="bcp14">MUST</span> ensure that the resulting pathname is safe and does not allow path
traversal attacks (e.g., "../" sequences). The algorithm as specified does not
explicitly sanitize these segments, so implementations should validate or
sanitize the final constructed URL before use.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="query-parameter-and-fragment-handling">
<section id="section-4.6">
        <h3 id="name-query-parameter-and-fragmen">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-query-parameter-and-fragmen" class="section-name selfRef">Query Parameter and Fragment Handling</a>
        </h3>
<p id="section-4.6-1">The query parameter merging behavior means that user-supplied query parameters
from the Request URL can overwrite destination URL parameters. This may be
desired behavior, but implementers should be aware that it could be used to
modify the intended destination behavior. Similarly, fragments from the Request
URL take precedence, which may override intended anchor targets in the
destination.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="redirect-chains">
<section id="section-4.7">
        <h3 id="name-redirect-chains">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-redirect-chains" class="section-name selfRef">Redirect Chains</a>
        </h3>
<p id="section-4.7-1">Even with loop protection, long redirect chains can be used for:<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7-2.1">
            <p id="section-4.7-2.1.1">Denial of service through excessive processing<a href="#section-4.7-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.7-2.2">
            <p id="section-4.7-2.2.1">Obfuscation of final destination<a href="#section-4.7-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.7-2.3">
            <p id="section-4.7-2.3.1">Tracking or analytics purposes<a href="#section-4.7-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.7-3">Implementations should consider logging redirect chains and potentially limiting
chain length more aggressively than the 256-iteration limit.<a href="#section-4.7-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-5">
      <h2 id="name-iana-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-5-1">This document has no IANA actions.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-normative-references">
<section id="section-6">
      <h2 id="name-normative-references">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
    <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">This document was inspired by the need for consistent shortlink resolution
across different implementations and platforms.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ethan Davidson</span></div>
<div dir="auto" class="left"><span class="org">FartLabs</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ethan@wazoo.tech" class="email">ethan@wazoo.tech</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
